import random
import ipaddress
from flask import Flask, request, jsonify

# --- دیکشنری‌های IP ---
country_ipv6_ranges = {
    "Afghanistan": ["2406:cc40::/32"],
    "Albania": ["2a03:1c20::/29"],
    "Algeria": ["2c0f:fe38::/32"],
    "Andorra": ["2a01:8900::/29"],
    "Angola": ["2c0f:f6a0::/32"],
    "Argentina": ["2801:140::/32"],
    "Armenia": ["2a00:5d00::/32"],
    "Australia": ["2403:5800::/32", "2406:da00::/40"],
    "Austria": ["2a02:28a0::/29"],
    "Azerbaijan": ["2a00:1d40::/29"],
    "Bahamas": ["2a02:ce00::/29"],
    "Bahrain": ["2a00:1e80::/29"],
    "Bangladesh": ["2402:1f00::/32"],
    "Barbados": ["2801:0::/32"],
    "Belarus": ["2a0a:2a40::/29"],
    "Belgium": ["2a02:1800::/29"],
    "Belize": ["2801:0:e000::/32"],
    "Benin": ["2c0f:f4c0::/32"],
    "Bhutan": ["2405:8400::/32"],
    "Bolivia": ["2801:190::/32"],
    "Bosnia and Herzegovina": ["2a02:28f0::/29"],
    "Botswana": ["2c0f:fe90::/32"],
    "Brazil": ["2801:80::/32", "2804:10c::/32"],
    "Brunei": ["2404:a800::/32"],
    "Bulgaria": ["2a01:5b0::/32"],
    "Burkina Faso": ["2c0f:fb40::/32"],
    "Burundi": ["2c0f:fb60::/32"],
    "Cabo Verde": ["2c0f:fd00::/32"],
    "Cambodia": ["2403:cc00::/32"],
    "Cameroon": ["2c0f:fa60::/32"],
    "Canada": ["2607:5300::/32", "2605:8b80::/29"],
    "Central African Republic": ["2c0f:f840::/32"],
    "Chad": ["2c0f:fe20::/32"],
    "Chile": ["2801:1e00::/32"],
    "China": ["240e::/20"],
    "Colombia": ["2801:0:4000::/32"],
    "Comoros": ["2c0f:fcb0::/32"],
    "Congo": ["2c0f:fcc0::/32"],
    "Costa Rica": ["2801:1400::/32"],
    "Croatia": ["2a02:26e0::/29"],
    "Cuba": ["2801:1f00::/32"],
    "Cyprus": ["2a00:1a80::/29"],
    "Czech Republic": ["2a02:a00::/29"],
    "Denmark": ["2a00:1a00::/29"],
    "Djibouti": ["2c0f:fe40::/32"],
    "Dominica": ["2801:0:c000::/32"],
    "Dominican Republic": ["2803:c800::/32"],
    "East Timor": ["2400:dc00::/32"],
    "Ecuador": ["2801:1100::/32"],
    "Egypt": ["2c0f:fb80::/32"],
    "El Salvador": ["2803:8200::/32"],
    "Equatorial Guinea": ["2c0f:fb20::/32"],
    "Eritrea": ["2c0f:fa80::/32"],
    "Estonia": ["2a02:e00::/29"],
    "Eswatini": ["2c0f:fb60::/32"],
    "Ethiopia": ["2c0f:feb0::/32"],
    "Fiji": ["2407:8000::/32"],
    "Finland": ["2a02:1348::/29"],
    "France": ["2a01:e00::/26", "2a00:5881::/32"],
    "Gabon": ["2c0f:f940::/32"],
    "Gambia": ["2c0f:fec0::/32"],
    "Georgia": ["2a02:778::/29"],
    "Germany": ["2a02:8100::/29", "2a00:1450::/32"],
    "Ghana": ["2c0f:f840::/32"],
    "Greece": ["2a02:580::/29"],
    "Greenland": ["2a00:ad00::/29"],
    "Grenada": ["2801:0:d000::/32"],
    "Guatemala": ["2801:1a00::/32"],
    "Guinea": ["2c0f:fdb0::/32"],
    "Guinea-Bissau": ["2c0f:fdc0::/32"],
    "Guyana": ["2801:0:1000::/32"],
    "Haiti": ["2803:fa00::/32"],
    "Honduras": ["2803:f600::/32"],
    "Hungary": ["2a02:280::/29"],
    "Iceland": ["2a02:a200::/29"],
    "India": ["2400:3200::/32"],
    "Indonesia": ["2404:e800::/32"],
    "Iran": ["2a00:1a90::/29"],
    "Iraq": ["2c0f:f8b0::/32"],
    "Ireland": ["2a01:300::/29"],
    "Israel": ["2a00:a040::/29"],
    "Italy": ["2a02:728::/29"],
    "Ivory Coast": ["2c0f:fce0::/32"],
    "Jamaica": ["2803:980::/32"],
    "Japan": ["2404:6800::/32", "2406:3000::/26"],
    "Jordan": ["2c0f:fb00::/32"],
    "Kazakhstan": ["2a00:abd0::/29"],
    "Kenya": ["2c0f:fe60::/32"],
    "Kiribati": ["2401:e00::/32"],
    "Kuwait": ["2a00:1a70::/29"],
    "Kyrgyzstan": ["2a00:1b00::/29"],
    "Laos": ["2406:5800::/32"],
    "Latvia": ["2a02:9a00::/29"],
    "Lebanon": ["2c0f:fef0::/32"],
    "Lesotho": ["2c0f:fa90::/32"],
    "Liberia": ["2c0f:fab0::/32"],
    "Libya": ["2c0f:fa00::/32"],
    "Liechtenstein": ["2a02:4b00::/29"],
    "Lithuania": ["2a02:9300::/29"],
    "Luxembourg": ["2a02:1b00::/29"],
    "Madagascar": ["2c0f:fb40::/32"],
    "Malawi": ["2c0f:f9a0::/32"],
    "Malaysia": ["2401:3c00::/32"],
    "Maldives": ["2404:9a00::/32"],
    "Mali": ["2c0f:fb90::/32"],
    "Malta": ["2a02:980::/29"],
    "Marshall Islands": ["2401:8000::/32"],
    "Mauritania": ["2c0f:fc80::/32"],
    "Mauritius": ["2c0f:f920::/32"],
    "Mexico": ["2801:10c::/32"],
    "Micronesia": ["2401:800::/32"],
    "Moldova": ["2a00:ec80::/29"],
    "Monaco": ["2a02:ec0::/29"],
    "Mongolia": ["2402:800::/32"],
    "Montenegro": ["2a00:1600::/29"],
    "Morocco": ["2c0f:fb60::/32"],
    "Mozambique": ["2c0f:fba0::/32"],
    "Myanmar": ["2402:3a00::/32"],
    "Namibia": ["2c0f:fb20::/32"],
    "Nauru": ["2401:9c00::/32"],
    "Nepal": ["2402:3a00::/32"],
    "Netherlands": ["2a02:a000::/29"],
    "New Zealand": ["2404:1380::/32"],
    "Nicaragua": ["2803:8800::/32"],
    "Niger": ["2c0f:fa10::/32"],
    "Nigeria": ["2c0f:f9c0::/32"],
    "North Korea": ["2c0f:fd00::/32"],
    "North Macedonia": ["2a02:28f0::/29"],
    "Norway": ["2a01:79c0::/29"],
    "Oman": ["2a02:16c0::/29"],
    "Pakistan": ["2402:8000::/32"],
    "Palau": ["2401:8a00::/32"],
    "Palestine": ["2a02:6c0::/29"],
    "Panama": ["2801:1400::/32"],
    "Papua New Guinea": ["2403:6c00::/32"],
    "Paraguay": ["2801:1300::/32"],
    "Peru": ["2801:1400::/32"],
    "Philippines": ["2406:8000::/32"],
    "Poland": ["2a00:f8c0::/29"],
    "Portugal": ["2a02:1600::/29"],
    "Qatar": ["2a00:1e80::/29"],
    "Romania": ["2a02:2f00::/29"],
    "Russia": ["2a02:6b8::/32", "2a00:bdc0::/32"],
    "Rwanda": ["2c0f:fb40::/32"],
    "Saint Kitts and Nevis": ["2801:0:dc00::/32"],
    "Saint Lucia": ["2801:0:e000::/32"],
    "Saint Vincent and the Grenadines": ["2801:0:e800::/32"],
    "Samoa": ["2404:4c00::/32"],
    "San Marino": ["2a02:9800::/29"],
    "Sao Tome and Principe": ["2c0f:fa70::/32"],
    "Saudi Arabia": ["2a00:1a00::/29"],
    "Senegal": ["2c0f:f960::/32"],
    "Serbia": ["2a02:28f0::/29"],
    "Seychelles": ["2c0f:fa80::/32"],
    "Sierra Leone": ["2c0f:faa0::/32"],
    "Singapore": ["2401:dc00::/32"],
    "Slovakia": ["2a00:1dc0::/29"],
    "Slovenia": ["2a02:280::/29"],
    "Solomon Islands": ["2401:fa00::/32"],
    "Somalia": ["2c0f:fb50::/32"],
    "South Africa": ["2c0f:f8c0::/32"],
    "South Korea": ["2404:3600::/32"],
    "South Sudan": ["2c0f:fc00::/32"],
    "Spain": ["2a02:1800::/29"],
    "Sri Lanka": ["2402:400::/32"],
    "Sudan": ["2c0f:fa40::/32"],
    "Suriname": ["2801:1000::/32"],
    "Sweden": ["2a00:1400::/29"],
    "Switzerland": ["2a02:1680::/29"],
    "Syria": ["2c0f:fa30::/32"],
    "Taiwan": ["2405:200::/32"],
    "Tajikistan": ["2a00:1800::/29"],
    "Tanzania": ["2c0f:fa50::/32"],
    "Thailand": ["2403:e800::/32"],
    "Togo": ["2c0f:fa20::/32"],
    "Tonga": ["2401:800::/32"],
    "Trinidad and Tobago": ["2803:800::/32"],
    "Tunisia": ["2c0f:fa60::/32"],
    "Turkey": ["2a02:1400::/29"],
    "Turkmenistan": ["2a00:1100::/29"],
    "Tuvalu": ["2401:ca00::/32"],
    "Uganda": ["2c0f:fb90::/32"],
    "Ukraine": ["2a00:1dc0::/29"],
    "United Arab Emirates": ["2a00:1e80::/29"],
    "United Kingdom": ["2a00:2381::/32", "2a01:4b00::/29"],
    "United States": ["2607:f8b0::/32", "2620:0:2d0::/48"],
    "Uruguay": ["2801:1000::/32"],
    "Uzbekistan": ["2a00:ac00::/29"],
    "Vanuatu": ["2404:c800::/32"],
    "Vatican City": ["2a00:1a80::/29"],
    "Venezuela": ["2800:1e00::/32"],
    "Vietnam": ["2405:4800::/32", "2402:800::/32"],
    "Yemen": ["2c0f:fb20::/32"],
    "Zambia": ["2c0f:fb30::/32"],
    "Zimbabwe": ["2c0f:fb40::/32"]
}

country_ipv4_ranges = {
    "Afghanistan": ["103.255.44.0/22"],
    "Albania": ["79.128.0.0/9"],
    "Algeria": ["41.200.0.0/13"],
    "Andorra": ["85.92.0.0/14"],
    "Angola": ["105.168.0.0/13"],
    "Argentina": ["181.0.0.0/12"],
    "Armenia": ["188.160.0.0/11"],
    "Australia": ["1.0.0.0/8"],
    "Austria": ["80.64.0.0/10"],
    "Azerbaijan": ["5.191.0.0/16"],
    "Bahamas": ["24.32.0.0/16"],
    "Bahrain": ["37.131.0.0/17"],
    "Bangladesh": ["114.130.0.0/16"],
    "Barbados": ["23.128.0.0/12"],
    "Belarus": ["178.120.0.0/13"],
    "Belgium": ["81.240.0.0/12"],
    "Belize": ["45.56.0.0/16"],
    "Benin": ["197.250.0.0/16"],
    "Bhutan": ["119.2.96.0/19"],
    "Bolivia": ["190.180.0.0/14"],
    "Bosnia and Herzegovina": ["31.176.0.0/12"],
    "Botswana": ["160.120.0.0/14"],
    "Brazil": ["187.0.0.0/8"],
    "Brunei": ["119.160.0.0/11"],
    "Bulgaria": ["87.116.0.0/14"],
    "Burkina Faso": ["197.157.0.0/16"],
    "Burundi": ["154.117.0.0/16"],
    "Cabo Verde": ["197.159.160.0/19"],
    "Cambodia": ["49.156.0.0/16"],
    "Cameroon": ["129.0.0.0/16"],
    "Canada": ["24.48.0.0/12"],
    "Central African Republic": ["197.242.0.0/16"],
    "Chad": ["154.73.0.0/16"],
    "Chile": ["186.0.0.0/8"],
    "China": ["1.0.1.0/24"],
    "Colombia": ["186.112.0.0/12"],
    "Comoros": ["197.255.0.0/16"],
    "Congo": ["41.74.0.0/16"],
    "Costa Rica": ["190.10.0.0/15"],
    "Croatia": ["93.128.0.0/12"],
    "Cuba": ["190.6.64.0/18"],
    "Cyprus": ["93.104.0.0/14"],
    "Czech Republic": ["78.96.0.0/12"],
    "Denmark": ["80.160.0.0/12"],
    "Djibouti": ["197.241.0.0/16"],
    "Dominica": ["192.243.48.0/20"],
    "Dominican Republic": ["190.120.0.0/13"],
    "East Timor": ["103.14.224.0/22"],
    "Ecuador": ["186.68.0.0/14"],
    "Egypt": ["156.208.0.0/12"],
    "El Salvador": ["168.243.0.0/16"],
    "Equatorial Guinea": ["197.158.64.0/18"],
    "Eritrea": ["197.156.64.0/18"],
    "Estonia": ["88.196.0.0/14"],
    "Eswatini": ["196.28.0.0/16"],
    "Ethiopia": ["213.55.64.0/18"],
    "Fiji": ["144.120.0.0/16"],
    "Finland": ["80.220.0.0/14"],
    "France": ["88.160.0.0/11"],
    "Gabon": ["197.149.0.0/16"],
    "Gambia": ["197.255.64.0/18"],
    "Georgia": ["176.74.0.0/15"],
    "Germany": ["91.0.0.0/11"],
    "Ghana": ["154.160.0.0/11"],
    "Greece": ["46.12.0.0/14"],
    "Greenland": ["88.80.0.0/14"],
    "Grenada": ["192.147.0.0/16"],
    "Guatemala": ["168.234.0.0/16"],
    "Guinea": ["197.149.32.0/19"],
    "Guinea-Bissau": ["197.150.0.0/16"],
    "Guyana": ["190.80.0.0/16"],
    "Haiti": ["200.113.0.0/20"],
    "Honduras": ["181.210.0.0/15"],
    "Hungary": ["84.0.0.0/12"],
    "Iceland": ["82.221.0.0/15"],
    "India": ["49.32.0.0/11"],
    "Indonesia": ["114.124.0.0/14"],
    "Iran": ["46.224.0.0/11"],
    "Iraq": ["37.236.0.0/16"],
    "Ireland": ["79.97.0.0/11"],
    "Israel": ["77.125.0.0/16"],
    "Italy": ["93.32.0.0/11"],
    "Ivory Coast": ["154.32.0.0/11"],
    "Jamaica": ["72.27.0.0/16"],
    "Japan": ["133.0.0.0/8"],
    "Jordan": ["94.142.0.0/16"],
    "Kazakhstan": ["2.72.0.0/13"],
    "Kenya": ["41.204.0.0/15"],
    "Kiribati": ["202.4.48.0/21"],
    "Kuwait": ["94.128.0.0/11"],
    "Kyrgyzstan": ["31.192.0.0/11"],
    "Laos": ["103.1.148.0/22"],
    "Latvia": ["91.198.0.0/15"],
    "Lebanon": ["178.135.0.0/16"],
    "Lesotho": ["41.203.160.0/19"],
    "Liberia": ["41.57.0.0/16"],
    "Libya": ["41.208.0.0/13"],
    "Liechtenstein": ["82.117.0.0/17"],
    "Lithuania": ["78.56.0.0/13"],
    "Luxembourg": ["85.92.0.0/14"],
    "Madagascar": ["154.126.0.0/15"],
    "Malawi": ["105.232.0.0/14"],
    "Malaysia": ["175.136.0.0/13"],
    "Maldives": ["27.114.0.0/15"],
    "Mali": ["41.138.0.0/15"],
    "Malta": ["78.128.0.0/13"],
    "Marshall Islands": ["119.252.112.0/21"],
    "Mauritania": ["41.188.64.0/18"],
    "Mauritius": ["41.76.0.0/15"],
    "Mexico": ["189.0.0.0/10"],
    "Micronesia": ["119.252.120.0/21"],
    "Moldova": ["85.232.0.0/14"],
    "Monaco": ["212.129.0.0/14"],
    "Mongolia": ["103.9.88.0/22"],
    "Montenegro": ["212.200.0.0/13"],
    "Morocco": ["196.200.0.0/13"],
    "Mozambique": ["197.218.0.0/15"],
    "Myanmar": ["103.255.172.0/22"],
    "Namibia": ["41.182.0.0/15"],
    "Nauru": ["203.98.224.0/19"],
    "Nepal": ["49.244.0.0/16"],
    "Netherlands": ["80.0.0.0/7"],
    "New Zealand": ["122.56.0.0/14"],
    "Nicaragua": ["186.76.0.0"],
    "Niger": ["197.214.0.0/16"],
    "Nigeria": ["41.58.0.0/15"],
    "North Korea": ["175.45.176.0/22"],
    "North Macedonia": ["77.28.0.0/15"],
    "Norway": ["84.208.0.0/13"],
    "Oman": ["82.178.0.0/15"],
    "Pakistan": ["39.32.0.0/11"],
    "Palau": ["119.252.112.0/21"],
    "Palestine": ["46.0.0.0/11"],
    "Panama": ["186.72.0.0/14"],
    "Papua New Guinea": ["202.1.160.0/20"],
    "Paraguay": ["190.128.0.0/14"],
    "Peru": ["190.232.0.0/13"],
    "Philippines": ["112.198.0.0/15"],
    "Poland": ["83.0.0.0/8"],
    "Portugal": ["85.240.0.0/13"],
    "Qatar": ["82.148.0.0/14"],
    "Romania": ["86.104.0.0/13"],
    "Russia": ["5.18.0.0/15"],
    "Rwanda": ["154.68.0.0/14"],
    "Saint Kitts and Nevis": ["198.49.88.0/22"],
    "Saint Lucia": ["216.49.160.0/19"],
    "Saint Vincent and the Grenadines": ["206.48.0.0/18"],
    "Samoa": ["202.134.32.0/19"],
    "San Marino": ["212.13.0.0/19"],
    "Sao Tome and Principe": ["197.159.96.0/19"],
    "Saudi Arabia": ["212.26.0.0/15"],
    "Senegal": ["41.82.0.0/14"],
    "Serbia": ["109.92.0.0/15"],
    "Seychelles": ["154.192.0.0/13"],
    "Sierra Leone": ["41.205.160.0/19"],
    "Singapore": ["27.0.0.0/8"],
    "Slovakia": ["84.245.0.0/16"],
    "Slovenia": ["91.185.0.0/16"],
    "Solomon Islands": ["202.1.160.0/20"],
    "Somalia": ["154.115.0.0/16"],
    "South Africa": ["41.160.0.0/11"],
    "South Korea": ["58.224.0.0/11"],
    "South Sudan": ["41.78.192.0/18"],
    "Spain": ["85.48.0.0/12"],
    "Sri Lanka": ["112.135.0.0/16"],
    "Sudan": ["154.128.0.0/14"],
    "Suriname": ["186.179.128.0/17"],
    "Sweden": ["78.72.0.0/13"],
    "Switzerland": ["85.0.0.0/10"],
    "Syria": ["213.178.224.0/19"],
    "Taiwan": ["60.198.0.0/15"],
    "Tajikistan": ["85.9.0.0/16"],
    "Tanzania": ["41.93.0.0/16"],
    "Thailand": ["49.48.0.0/14"],
    "Togo": ["41.207.192.0/18"],
    "Tonga": ["175.176.0.0/19"],
    "Trinidad and Tobago": ["190.58.0.0/15"],
    "Tunisia": ["41.224.0.0/12"],
    "Turkey": ["78.160.0.0/11"],
    "Turkmenistan": ["217.174.224.0/19"],
    "Tuvalu": ["203.32.128.0/19"],
    "Uganda": ["41.210.0.0/16"],
    "Ukraine": ["95.132.0.0/14"],
    "United Arab Emirates": ["94.200.0.0/13"],
    "United Kingdom": ["80.0.0.0/8"],
    "United States": ["3.0.0.0/8"],
    "Uruguay": ["179.24.0.0/14"],
    "Uzbekistan": ["84.54.0.0/15"],
    "Vanuatu": ["202.80.32.0/19"],
    "Vatican City": ["212.77.0.0/24"],
    "Venezuela": ["186.24.0.0/13"],
    "Vietnam": ["14.160.0.0/11"],
    "Yemen": ["82.114.160.0/20"],
    "Zambia": ["197.220.0.0/14"],
    "Zimbabwe": ["41.57.96.0/19"]
}

# --- تولید IP ---
def generate_ip(country, ip_version):
    if ip_version == "ipv6":
        ranges = country_ipv6_ranges.get(country)
        ip_class = ipaddress.IPv6Network
    elif ip_version == "ipv4":
        ranges = country_ipv4_ranges.get(country)
        ip_class = ipaddress.IPv4Network
    else:
        return ["Invalid IP version. Please choose 'IPv4' or 'IPv6'."]

    if not ranges:
        return [f"No {ip_version.upper()} ranges found for '{country}'"]

    network = ip_class(random.choice(ranges))
    addresses = set()

    while len(addresses) < 20:
        try:
            ip_int = random.randint(int(network.network_address) + 1, int(network.broadcast_address) - 1)
            addresses.add(str(ip_class(ip_int)))
        except ValueError:
            continue

    return list(addresses)

# --- تنظیمات API ---
app = Flask(__name__)

@app.route('/generate', methods=['GET'])
def generate_ip_api():
    country = request.args.get('country')
    ip_version = request.args.get('version', 'ipv4').lower()

    if not country:
        return jsonify({"error": "Country is required"}), 400

    if ip_version not in ("ipv4", "ipv6"):
        return jsonify({"error": "Invalid IP version. Use 'ipv4' or 'ipv6'."}), 400

    result = generate_ip(country, ip_version)
    return jsonify({
        "country": country,
        "ip_version": ip_version.upper(),
        "addresses": result
    })

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)